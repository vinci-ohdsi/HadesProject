<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Jenna Reps, Martijn J. Schuemie, Patrick B. Ryan, Peter R. Rijnbeek" />

<meta name="date" content="2025-07-25" />

<title>Automatically Build Multiple Patient-Level Predictive Models</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Automatically Build Multiple Patient-Level
Predictive Models</h1>
<h4 class="author">Jenna Reps, Martijn J. Schuemie, Patrick B. Ryan,
Peter R. Rijnbeek</h4>
<h4 class="date">2025-07-25</h4>



<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Automatically Build Multiple Patient-Level Predictive Models}
%\VignetteEncoding{UTF-8}
-->
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In our <a href="https://doi.org/10.1093/jamia/ocy032"><code>paper</code></a>, we
propose a standardised framework for patient-level prediction that
utilizes the OMOP CDM and standardized vocabularies, and describe the
open-source software that we developed implementing the framework’s
pipeline. The framework is the first to enforce existing best practice
guidelines and will enable open dissemination of models that can be
extensively validated across the network of OHDSI collaborators.</p>
<p>One our best practices is that we see the selection of models and all
study setting as an emperical question, i.e. we should use a data-driven
approach in which we try many settings. This vignette describes how you
can use the Observational Health Data Sciencs and Informatics (OHDSI) <a href="https://github.com/OHDSI/PatientLevelPrediction"><code>PatientLevelPrediction</code></a>
package to automatically build multiple patient-level predictive models,
e.g. different population settings, covariate settings, and
modelsetting. This vignette assumes you have read and are comfortable
with building single patient level prediction models as described in the
<code>vignette(&#39;BuildingPredictiveModels&#39;)</code>.</p>
<p>Note that it is also possible to generate a Study Package directly in
Atlas that allows for multiple patient-level prediction analyses this is
out-of-scope for this vignette.</p>
</div>
<div id="creating-a-model-design" class="section level1">
<h1>Creating a model design</h1>
<p>The first step is to specify each model you wish to develop by using
the <code>createModelDesign</code> function. This function requires the
following:</p>
<table>
<caption>The inputs for the model design</caption>
<colgroup>
<col width="17%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">input</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">targetId</td>
<td align="left">The id for the target cohort</td>
</tr>
<tr class="even">
<td align="left">outcomeId</td>
<td align="left">The id for the outcome</td>
</tr>
<tr class="odd">
<td align="left">restrictPlpDataSettings</td>
<td align="left">The settings used to restrict the target population,
created with createRestrictPlpDataSettings()</td>
</tr>
<tr class="even">
<td align="left">populationSettings</td>
<td align="left">The settings used to restrict the target population and
create the outcome labels, created with
createStudyPopulationSettings()</td>
</tr>
<tr class="odd">
<td align="left">covariateSettings</td>
<td align="left">The settings used to define the covariates, created
with FeatureExtraction::createDefaultCovariateSettings()</td>
</tr>
<tr class="even">
<td align="left">sampleSettings</td>
<td align="left">The settings used to define any under/over sampling,
created with createSampleSettings()</td>
</tr>
<tr class="odd">
<td align="left">featureEngineeringSettings</td>
<td align="left">The settings used to define any feature engineering,
created with createFeatureEngineeringSettings()</td>
</tr>
<tr class="even">
<td align="left">preprocessSettings</td>
<td align="left">The settings used to define any preprocessing, created
with createPreprocessSettings()</td>
</tr>
<tr class="odd">
<td align="left">modelSettings</td>
<td align="left">The settings used to define the model fitting settings,
such as setLassoLogisticRegression()</td>
</tr>
</tbody>
</table>
<div id="model-design-example-1" class="section level2">
<h2>Model design example 1</h2>
<p>For example, if we wanted to predict the outcome (id 2) occuring for
the first time within 180 days of the the target population index date
(id 1). We are only interested in index dates betwrrn 2018-2020.
Finally, we only want to use age, gender in 5 year buckets and
conditions as features. The model can be specified by:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Model 1 is only using data between 2018-2020:</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>restrictPlpDataSettings <span class="ot">&lt;-</span> <span class="fu">createRestrictPlpDataSettings</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">studyStartDate =</span> <span class="st">&quot;20180101&quot;</span>, </span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">studyEndDate =</span> <span class="st">&quot;20191231&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  )</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># predict outcome within 1 to 180 days after index</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># remove people with outcome prior and with &lt; 365 days observation</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>populationSettings <span class="ot">&lt;-</span> <span class="fu">createStudyPopulationSettings</span>(</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="at">binary =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="at">firstExposureOnly =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="at">washoutPeriod =</span> <span class="dv">365</span>, </span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="at">removeSubjectsWithPriorOutcome =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="at">priorOutcomeLookback =</span> <span class="dv">9999</span>,</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="at">requireTimeAtRisk =</span> <span class="cn">FALSE</span>, </span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  <span class="at">riskWindowStart =</span> <span class="dv">1</span>, </span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  <span class="at">riskWindowEnd =</span> <span class="dv">180</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co"># use age/gender in groups and condition groups as features</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>covariateSettings <span class="ot">&lt;-</span> FeatureExtraction<span class="sc">::</span><span class="fu">createCovariateSettings</span>(</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>  <span class="at">useDemographicsGender =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>  <span class="at">useDemographicsAgeGroup =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>  <span class="at">useConditionGroupEraAnyTimePrior =</span> <span class="cn">TRUE</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>)</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>modelDesign1 <span class="ot">&lt;-</span> <span class="fu">createModelDesign</span>(</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>  <span class="at">targetId =</span> <span class="dv">1</span>, </span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>  <span class="at">outcomeId =</span> <span class="dv">2</span>, </span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>  <span class="at">restrictPlpDataSettings =</span> restrictPlpDataSettings, </span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>  <span class="at">populationSettings =</span> populationSettings, </span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>  <span class="at">covariateSettings =</span> covariateSettings, </span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>  <span class="at">featureEngineeringSettings =</span> <span class="fu">createFeatureEngineeringSettings</span>(),</span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>  <span class="at">sampleSettings =</span> <span class="fu">createSampleSettings</span>(), </span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>  <span class="at">splitSettings =</span> <span class="fu">createDefaultSplitSetting</span>(), </span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>  <span class="at">preprocessSettings =</span> <span class="fu">createPreprocessSettings</span>(), </span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>  <span class="at">modelSettings =</span> <span class="fu">setLassoLogisticRegression</span>()</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="model-design-example-2" class="section level2">
<h2>Model design example 2</h2>
<p>For the second example, we want to predict the outcome (id 2)
occuring for the first time within 730 days of the the target population
index date (id 1). We want to train a random forest classifier. Finally,
we want to use age, gender in 5 year buckets, drug ingredients (and
groups) and conditions as features. The model can be specified by:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Model 2 has no restrictions when extracting data</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>restrictPlpDataSettings <span class="ot">&lt;-</span> <span class="fu">createRestrictPlpDataSettings</span>(</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  )</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co"># predict outcome within 1 to 730 days after index</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co"># remove people with outcome prior and with &lt; 365 days observation</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>populationSettings <span class="ot">&lt;-</span> <span class="fu">createStudyPopulationSettings</span>(</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="at">binary =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="at">firstExposureOnly =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="at">washoutPeriod =</span> <span class="dv">365</span>, </span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  <span class="at">removeSubjectsWithPriorOutcome =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  <span class="at">priorOutcomeLookback =</span> <span class="dv">9999</span>,</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  <span class="at">requireTimeAtRisk =</span> <span class="cn">FALSE</span>, </span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>  <span class="at">riskWindowStart =</span> <span class="dv">1</span>, </span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>  <span class="at">riskWindowEnd =</span> <span class="dv">730</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>)</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co"># use age/gender in groups and condition/drug groups as features</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>covariateSettings <span class="ot">&lt;-</span> FeatureExtraction<span class="sc">::</span><span class="fu">createCovariateSettings</span>(</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>  <span class="at">useDemographicsGender =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>  <span class="at">useDemographicsAgeGroup =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>  <span class="at">useConditionGroupEraAnyTimePrior =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>  <span class="at">useDrugGroupEraAnyTimePrior =</span> <span class="cn">TRUE</span> </span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>)</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>modelDesign2 <span class="ot">&lt;-</span> <span class="fu">createModelDesign</span>(</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>  <span class="at">targetId =</span> <span class="dv">1</span>, </span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>  <span class="at">outcomeId =</span> <span class="dv">2</span>, </span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>  <span class="at">restrictPlpDataSettings =</span> restrictPlpDataSettings, </span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>  <span class="at">populationSettings =</span> populationSettings, </span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>  <span class="at">covariateSettings =</span> covariateSettings, </span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>  <span class="at">featureEngineeringSettings =</span> <span class="fu">createRandomForestFeatureSelection</span>(<span class="at">ntrees =</span> <span class="dv">500</span>, <span class="at">maxDepth =</span> <span class="dv">7</span>),</span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>  <span class="at">sampleSettings =</span> <span class="fu">createSampleSettings</span>(), </span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>  <span class="at">splitSettings =</span> <span class="fu">createDefaultSplitSetting</span>(), </span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>  <span class="at">preprocessSettings =</span> <span class="fu">createPreprocessSettings</span>(), </span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>  <span class="at">modelSettings =</span> <span class="fu">setRandomForest</span>()</span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="model-design-example-3" class="section level2">
<h2>Model design example 3</h2>
<p>For the third example, we want to predict the outcome (id 5) occuring
during the cohort exposure of the the target population (id 1). We want
to train a gradient boosting machine. Finally, we want to use age,
gender in 5 year buckets and indications of measurements taken as
features. The model can be specified by:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Model 3 has no restrictions when extracting data</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>restrictPlpDataSettings <span class="ot">&lt;-</span> <span class="fu">createRestrictPlpDataSettings</span>(</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  )</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co"># predict outcome during target cohort start/end </span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co"># remove people with  &lt; 365 days observation</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>populationSettings <span class="ot">&lt;-</span> <span class="fu">createStudyPopulationSettings</span>(</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="at">binary =</span> <span class="cn">TRUE</span>, </span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="at">firstExposureOnly =</span> <span class="cn">TRUE</span>, </span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="at">washoutPeriod =</span> <span class="dv">365</span>, </span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  <span class="at">removeSubjectsWithPriorOutcome =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="at">requireTimeAtRisk =</span> <span class="cn">FALSE</span>, </span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="at">riskWindowStart =</span> <span class="dv">0</span>,</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="at">startAnchor =</span>  <span class="st">&quot;cohort start&quot;</span>,</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="at">riskWindowEnd =</span> <span class="dv">0</span>, </span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  <span class="at">endAnchor =</span> <span class="st">&quot;cohort end&quot;</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co"># use age/gender in groups and measurement indicators as features</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>covariateSettings <span class="ot">&lt;-</span> FeatureExtraction<span class="sc">::</span><span class="fu">createCovariateSettings</span>(</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="at">useDemographicsGender =</span> <span class="cn">TRUE</span>, </span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>  <span class="at">useDemographicsAgeGroup =</span> <span class="cn">TRUE</span>, </span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>  <span class="at">useMeasurementAnyTimePrior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>  <span class="at">endDays =</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>)</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>modelDesign3 <span class="ot">&lt;-</span> <span class="fu">createModelDesign</span>(</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>  <span class="at">targetId =</span> <span class="dv">1</span>, </span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>  <span class="at">outcomeId =</span> <span class="dv">5</span>, </span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>  <span class="at">restrictPlpDataSettings =</span> restrictPlpDataSettings, </span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>  <span class="at">populationSettings =</span> populationSettings, </span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>  <span class="at">covariateSettings =</span> covariateSettings, </span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>  <span class="at">featureEngineeringSettings =</span> <span class="fu">createFeatureEngineeringSettings</span>(),</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>  <span class="at">sampleSettings =</span> <span class="fu">createSampleSettings</span>(), </span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>  <span class="at">splitSettings =</span> <span class="fu">createDefaultSplitSetting</span>(), </span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>  <span class="at">preprocessSettings =</span> <span class="fu">createPreprocessSettings</span>(), </span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>  <span class="at">modelSettings =</span> <span class="fu">setGradientBoostingMachine</span>()</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>  )</span></code></pre></div>
</div>
</div>
<div id="running-multiple-models" class="section level1">
<h1>Running multiple models</h1>
<p>As we will be downloading loads of data in the multiple plp analysis
it is useful to set the Andromeda temp folder to a directory with write
access and plenty of space.
<code>options(andromedaTempFolder = &quot;c:/andromedaTemp&quot;)</code></p>
<p>To run the study requires setting up a connectionDetails object</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>dbms <span class="ot">&lt;-</span> <span class="st">&quot;your dbms&quot;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>user <span class="ot">&lt;-</span> <span class="st">&quot;your username&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>pw <span class="ot">&lt;-</span> <span class="st">&quot;your password&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="st">&quot;your server&quot;</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>port <span class="ot">&lt;-</span> <span class="st">&quot;your port&quot;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>connectionDetails <span class="ot">&lt;-</span> DatabaseConnector<span class="sc">::</span><span class="fu">createConnectionDetails</span>(<span class="at">dbms =</span> dbms,</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>                                                                <span class="at">server =</span> server,</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>                                                                <span class="at">user =</span> user,</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>                                                                <span class="at">password =</span> pw,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>                                                                <span class="at">port =</span> port)</span></code></pre></div>
<p>Next you need to specify the cdmDatabaseSchema where your cdm
database is found and workDatabaseSchema where your target population
and outcome cohorts are and you need to specify a label for the database
name: a string with a shareable name of the database (this will be shown
to OHDSI researchers if the results get transported).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>cdmDatabaseSchema <span class="ot">&lt;-</span> <span class="st">&quot;your cdmDatabaseSchema&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>workDatabaseSchema <span class="ot">&lt;-</span> <span class="st">&quot;your workDatabaseSchema&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>cdmDatabaseName <span class="ot">&lt;-</span> <span class="st">&quot;your cdmDatabaseName&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>cohortTable <span class="ot">&lt;-</span> <span class="st">&quot;your cohort table&quot;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>databaseDetails <span class="ot">&lt;-</span> <span class="fu">createDatabaseDetails</span>(</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="at">connectionDetails =</span> connectionDetails, </span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="at">cdmDatabaseSchema =</span> cdmDatabaseSchema, </span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="at">cdmDatabaseName =</span> cdmDatabaseName, </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="at">cohortDatabaseSchema =</span> workDatabaseSchema, </span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="at">cohortTable =</span> cohortTable, </span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  <span class="at">outcomeDatabaseSchema =</span> workDatabaseSchema, </span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  <span class="at">outcomeTable =</span> cohortTable,</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  <span class="at">cdmVersion =</span> <span class="dv">5</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>    )</span></code></pre></div>
<p>Now you can run the multiple patient-level prediction analysis:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">runMultiplePlp</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="at">databaseDetails =</span> databaseDetails,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">modelDesignList =</span> <span class="fu">list</span>(</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    modelDesign1,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    modelDesign2,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    modelDesign3</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  ),</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="at">onlyFetchData =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="at">logSettings =</span> <span class="fu">createLogSettings</span>(),</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="at">saveDirectory =</span> <span class="st">&quot;./PlpMultiOutput&quot;</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>)</span></code></pre></div>
<p>This will then save all the plpData objects from the study into
“./PlpMultiOutput/plpData_T1_L<i>” and the results into
“./PlpMultiOutput/Analysis_<i>”. The csv file named settings.csv found
in “./PlpMultiOutput” has a row for each prediction model developed and
points to the plpData and settings used for the model development, it
also has descriptions of the cohorts if these are input by the user.</p>
<p>Note that if for some reason the run is interrupted, e.g. because of
an error, a new call to <code>runMultiplePlp</code> will continue and
not restart until you remove the output folder.</p>
</div>
<div id="validating-multiple-models" class="section level1">
<h1>Validating multiple models</h1>
<p>If you have access to multiple databases on the same server in
different schemas you could evaluate accross these using this call:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>validationDatabaseDetails <span class="ot">&lt;-</span> <span class="fu">createDatabaseDetails</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="at">connectionDetails =</span> connectionDetails,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="at">cdmDatabaseSchema =</span> <span class="st">&quot;new cdm schema&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="at">cdmDatabaseName =</span> <span class="st">&quot;validation database&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="at">cohortDatabaseSchema =</span> workDatabaseSchema,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="at">cohortTable =</span> cohortTable,</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="at">outcomeDatabaseSchema =</span> workDatabaseSchema,</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="at">outcomeTable =</span> cohortTable,</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  <span class="at">cdmVersion =</span> <span class="dv">5</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>val <span class="ot">&lt;-</span> <span class="fu">validateMultiplePlp</span>(</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>  <span class="at">analysesLocation =</span> <span class="st">&quot;./PlpMultiOutput&quot;</span>,</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>  <span class="at">valdiationDatabaseDetails =</span> validationDatabaseDetails,</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  <span class="at">validationRestrictPlpDataSettings =</span> <span class="fu">createRestrictPlpDataSettings</span>(),</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  <span class="at">recalibrate =</span> <span class="cn">NULL</span>,</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>  <span class="at">saveDirectory =</span> <span class="st">&quot;./PlpMultiOutput/Validation&quot;</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>)</span></code></pre></div>
<p>This then saves the external validation results in the
<code>Validation</code> folder of the main study (the outputLocation you
used in runPlpAnalyses).</p>
</div>
<div id="viewing-the-results" class="section level1">
<h1>Viewing the results</h1>
<p>To view the results for the multiple prediction analysis:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">viewMultiplePlp</span>(<span class="at">analysesLocation =</span> <span class="st">&quot;./PlpMultiOutput&quot;</span>)</span></code></pre></div>
<p>If the validation directory in “./PlpMultiOutput” has a sqlite
results database, the external validation will also be displayed.</p>
</div>
<div id="acknowledgments" class="section level1">
<h1>Acknowledgments</h1>
<p>Considerable work has been dedicated to provide the
<code>PatientLevelPrediction</code> package.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">citation</span>(<span class="st">&quot;PatientLevelPrediction&quot;</span>)</span></code></pre></div>
<pre><code>## To cite PatientLevelPrediction in publications use:
## 
##   Reps JM, Schuemie MJ, Suchard MA, Ryan PB, Rijnbeek P (2018). &quot;Design
##   and implementation of a standardized framework to generate and
##   evaluate patient-level prediction models using observational
##   healthcare data.&quot; _Journal of the American Medical Informatics
##   Association_, *25*(8), 969-975.
##   &lt;https://doi.org/10.1093/jamia/ocy032&gt;.
## 
## A BibTeX entry for LaTeX users is
## 
##   @Article{,
##     author = {J. M. Reps and M. J. Schuemie and M. A. Suchard and P. B. Ryan and P. Rijnbeek},
##     title = {Design and implementation of a standardized framework to generate and evaluate patient-level prediction models using observational healthcare data},
##     journal = {Journal of the American Medical Informatics Association},
##     volume = {25},
##     number = {8},
##     pages = {969-975},
##     year = {2018},
##     url = {https://doi.org/10.1093/jamia/ocy032},
##   }</code></pre>
<p><strong>Please reference this paper if you use the PLP Package in
your work:</strong></p>
<p><a href="https://dx.doi.org/10.1093/jamia/ocy032">Reps JM, Schuemie
MJ, Suchard MA, Ryan PB, Rijnbeek PR. Design and implementation of a
standardized framework to generate and evaluate patient-level prediction
models using observational healthcare data. J Am Med Inform Assoc.
2018;25(8):969-975.</a></p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
