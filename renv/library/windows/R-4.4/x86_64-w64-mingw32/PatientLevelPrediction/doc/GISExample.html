<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Jared Houghtaling" />

<meta name="date" content="2025-07-25" />

<title>Integration of GIS Data Into OHDSI Model Building</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Integration of GIS Data Into OHDSI Model
Building</h1>
<h4 class="author">Jared Houghtaling</h4>
<h4 class="date">2025-07-25</h4>



<div id="integration-of-gis-data-into-ohdsi-model-building" class="section level1">
<h1>Integration of GIS Data into OHDSI Model Building</h1>
<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>Although the proposed GIS extension tables have been approved by the
broader OHDSI community, they are not yet integrated natively into the
OHDSI tooling. These tables and the data they capture, however, can
still be referenced in standard model building and analytics workflows.
The purpose of this analytics demonstration is to show how data in the
EXPOSURE_OCCURRENCE table can be utilized in the training and evaluation
of an OMOP-specific patient-level-prediction (PLP) model. The analytic
process we executed and describe below relies on a GIS-version of the
Tufts Synthetic Dataset that has both EHR and geospatial data
integrated; see the <a href="https://github.com/OHDSI/GIS/issues/345#issuecomment-2417261931">description</a>
of that dataset for more details about contents or access. Much of the
work is based on the detailed vignette that describes custom feature
engineering in PLP
<code>vignette(&#39;AddingCustomFeatureEngineering&#39;)</code></p>
</div>
<div id="step-by-step-process" class="section level2">
<h2>Step-by-Step Process</h2>
<div id="step-1-create-target-outcome-cohorts" class="section level3">
<h3>Step 1: Create Target &amp; Outcome Cohorts</h3>
<p>We defined our <code>target</code> cohort within the sampling
procedures when creating a subset of the Tufts Synthetic Data, and we
described this process at length elsewhere. For the purposes of using
the PLP package, we formalized this group of individuals in the cohort
table using a simple cohort definition including all individuals with
“any visit”, and include that atlas-compatible json definition here for
reference.</p>
<p>We also created our <code>outcome</code> cohort - in this case, those
patients with COPD or a conceptual descendant thereof - in Atlas and
have shared the json definition (we also included an equivalent SQL
script).</p>
</div>
<div id="step-2-create-generic-plp-lasso-logistic-regression-model-in-r" class="section level3">
<h3>Step 2: Create Generic PLP Lasso Logistic Regression Model in R</h3>
<p>It is possible to create an R package that serves as a basis for a
PLP model using Atlas, but given Atlas does not yet support the GIS
extension, we have created this demo model directly using the PLP
package.</p>
<p>After configuring the environment (very important!) appropriately, we
imported necessary packages and defined the relevant parameters about
the data source:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(PatientLevelPrediction)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>outputFolder <span class="ot">&lt;-</span> <span class="st">&quot;/ohdsi-gis/copdResultsPM25_NEW&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>saveDirectory <span class="ot">&lt;-</span> outputFolder</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>ExecutionDateTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>logSettings <span class="ot">=</span> <span class="fu">createLogSettings</span>(<span class="at">verbosity =</span> <span class="st">&quot;DEBUG&quot;</span>, <span class="at">timeStamp =</span> T, <span class="at">logName =</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>                                  <span class="st">&quot;runPlp Log&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>analysisName <span class="ot">=</span> <span class="st">&#39;Generic PLP&#39;</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Details for connecting to the server:</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>connectionDetails <span class="ot">&lt;-</span> DatabaseConnector<span class="sc">::</span><span class="fu">createConnectionDetails</span>(</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>        <span class="at">dbms =</span> <span class="st">&#39;spark&#39;</span>,</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>        <span class="at">server =</span> <span class="st">&#39;/default&#39;</span>,</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>        <span class="at">connectionString =</span> <span class="st">&#39;&lt;REDACTED&gt;&#39;</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    )</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co"># Add the database containing the OMOP CDM data</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>cdmDatabaseSchema <span class="ot">&lt;-</span> <span class="st">&#39;gis_syn_dataset_5_4&#39;</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co"># Add a sharebale name for the database containing the OMOP CDM data</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>cdmDatabaseName <span class="ot">&lt;-</span> <span class="st">&#39;TSD-GIS&#39;</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co"># Add a database with read/write access as this is where the cohorts will be generated</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>cohortDatabaseSchema <span class="ot">&lt;-</span> <span class="st">&#39;gis_syn_dataset_5_4&#39;</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>tempEmulationSchema <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co"># table name where the cohorts will be generated</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>cohortTable <span class="ot">&lt;-</span> <span class="st">&#39;cohort&#39;</span></span></code></pre></div>
<p>After defining parameters, we created a database settings object and
launched the <code>runMultiplePLP</code> function to create a base
<code>plpData</code> object:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>databaseDetails <span class="ot">&lt;-</span> PatientLevelPrediction<span class="sc">::</span><span class="fu">createDatabaseDetails</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>        <span class="at">connectionDetails =</span> connectionDetails, </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>        <span class="at">cdmDatabaseSchema =</span> cdmDatabaseSchema, </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>        <span class="at">cdmDatabaseName =</span> cdmDatabaseName, </span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="at">tempEmulationSchema =</span> tempEmulationSchema, </span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>        <span class="at">cohortDatabaseSchema =</span> cohortDatabaseSchema, </span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>        <span class="at">cohortTable =</span> cohortTable, </span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>        <span class="at">outcomeDatabaseSchema =</span> cohortDatabaseSchema,  </span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>        <span class="at">outcomeTable =</span> cohortTable, </span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>        <span class="at">cdmVersion =</span> <span class="dv">5</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>)</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co"># Run very simple LR model against two cohorts created in Atlas. Use model </span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co"># as basis for augmented model with pollutants below </span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="fu">runMultiplePlp</span>(</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>   <span class="at">databaseDetails =</span> databaseDetails,</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>   <span class="at">modelDesignList =</span> <span class="fu">list</span>(<span class="fu">createModelDesign</span>(<span class="at">targetId =</span> <span class="dv">9</span>, <span class="at">outcomeId =</span> <span class="dv">8</span>, <span class="at">modelSettings =</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>                                              <span class="fu">setLassoLogisticRegression</span>())),</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>   <span class="at">onlyFetchData =</span> F,</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>   <span class="at">cohortDefinitions =</span> <span class="cn">NULL</span>,</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>   <span class="at">logSettings =</span> <span class="fu">createLogSettings</span>(<span class="at">verbosity =</span> <span class="st">&quot;DEBUG&quot;</span>, <span class="at">timeStamp =</span> T, <span class="at">logName =</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>                                     <span class="st">&quot;runPlp Log&quot;</span>),</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>   <span class="at">saveDirectory =</span> outputFolder,</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>   <span class="at">sqliteLocation =</span> <span class="fu">file.path</span>(saveDirectory, <span class="st">&quot;sqlite&quot;</span>)</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a> )</span></code></pre></div>
</div>
<div id="step-3-split-plpdata-object-to-traintest-augment-labels-with-exposure_occurrence-values" class="section level3">
<h3>Step 3: Split plpData object to train/test, augment labels with
EXPOSURE_OCCURRENCE values</h3>
<p>The labels sub-object within <code>plpData</code> contains
per-individual data elements like gender and age; we added an additional
data element to this object derived from the
<code>EXPOSURE_OCCURRENCE</code> table:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>cohortDefinitions <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>modelDesign <span class="ot">&lt;-</span> <span class="fu">createModelDesign</span>(<span class="at">targetId =</span> <span class="dv">9</span>, <span class="at">outcomeId =</span> <span class="dv">8</span>, <span class="at">modelSettings =</span> <span class="fu">setLassoLogisticRegression</span>())</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>populationSettings <span class="ot">&lt;-</span> modelDesign<span class="sc">$</span>populationSettings</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>splitSettings <span class="ot">&lt;-</span> modelDesign<span class="sc">$</span>splitSettings</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>plpData <span class="ot">&lt;-</span> <span class="fu">loadPlpData</span>(<span class="st">&quot;/ohdsi-gis/copdResultsPM25_B/targetId_9_L1&quot;</span>)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>mySplit <span class="ot">&lt;-</span> <span class="fu">splitData</span> (<span class="at">plpData =</span> plpData,</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>                      <span class="at">population =</span> <span class="fu">createStudyPopulation</span>(plpData, <span class="dv">8</span>, populationSettings),</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>                      <span class="at">splitSettings =</span> splitSettings)</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>labelTrain <span class="ot">&lt;-</span> mySplit<span class="sc">$</span>Train<span class="sc">$</span>labels</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>conn <span class="ot">&lt;-</span> DatabaseConnector<span class="sc">::</span><span class="fu">connect</span>(connectionDetails)</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>pollutants <span class="ot">&lt;-</span> DatabaseConnector<span class="sc">::</span><span class="fu">querySql</span>(conn, <span class="st">&quot;SELECT person_id as subjectID, CAST(MEAN(value_as_number) AS DOUBLE) AS pmValue FROM gis_syn_dataset_5_4.exposure_occurrence WHERE value_as_number IS NOT NULL GROUP BY person_id;&quot;</span>)</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>labelTrainPol <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x=</span>labelTrain, <span class="at">y=</span>pollutants, <span class="at">by.x =</span> <span class="st">&quot;subjectId&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;SUBJECTID&quot;</span>)</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>mySplit<span class="sc">$</span>Train<span class="sc">$</span>labels <span class="ot">&lt;-</span> labelTrainPol</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>labelTest <span class="ot">&lt;-</span> mySplit<span class="sc">$</span>Test<span class="sc">$</span>labels</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>labelTestPol <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x=</span>labelTest, <span class="at">y=</span>pollutants, <span class="at">by.x =</span> <span class="st">&quot;subjectId&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;SUBJECTID&quot;</span>)</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>mySplit<span class="sc">$</span>Test<span class="sc">$</span>labels <span class="ot">&lt;-</span> labelTestPol</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>trainData <span class="ot">&lt;-</span> mySplit<span class="sc">$</span>Train</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>testData <span class="ot">&lt;-</span> mySplit<span class="sc">$</span>Test</span></code></pre></div>
</div>
<div id="step-4-reference-augmented-label-objects-in-custom-feature-engineering-function" class="section level3">
<h3>Step 4: Reference augmented label objects in custom feature
engineering function</h3>
<p>We would like to convert our per-patient labels into the
<code>covariateData</code> structure referenced by the PLP workflow. To
do this, we were able to follow the feature engineering vignette and
create two functions, <code>createPollutants</code> and
<code>implementPollutants</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>createPollutants <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&#39;QNCV&#39;</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>                     ){</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  </span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="co"># create list of inputs to implement function</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  featureEngineeringSettings <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">method =</span> method</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    )</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  </span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  <span class="co"># specify the function that will implement the sampling</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  <span class="fu">attr</span>(featureEngineeringSettings, <span class="st">&quot;fun&quot;</span>) <span class="ot">&lt;-</span> <span class="st">&quot;implementPollutants&quot;</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  <span class="co"># make sure the object returned is of class &quot;sampleSettings&quot;</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  <span class="fu">class</span>(featureEngineeringSettings) <span class="ot">&lt;-</span> <span class="st">&quot;featureEngineeringSettings&quot;</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  <span class="fu">return</span>(featureEngineeringSettings)</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  </span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>}</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>implementPollutants <span class="ot">&lt;-</span> <span class="cf">function</span>(trainData, featureEngineeringSettings, <span class="at">model=</span><span class="cn">NULL</span>) {</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(model)) {</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    method <span class="ot">&lt;-</span> featureEngineeringSettings<span class="sc">$</span>method</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>    gisData <span class="ot">&lt;-</span> trainData<span class="sc">$</span>labels</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>    y <span class="ot">&lt;-</span> gisData<span class="sc">$</span>outcomeCount</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>    X <span class="ot">&lt;-</span> gisData<span class="sc">$</span>PMVALUE</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>    model <span class="ot">&lt;-</span> mgcv<span class="sc">::</span><span class="fu">gam</span>(</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>      y <span class="sc">~</span> <span class="fu">s</span>(X, <span class="at">bs=</span><span class="st">&#39;cr&#39;</span>, <span class="at">k=</span><span class="dv">5</span>, <span class="at">m=</span><span class="dv">2</span>)</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>    )</span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>    newData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>      <span class="at">rowId =</span> gisData<span class="sc">$</span>rowId,</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>      <span class="at">covariateId =</span> <span class="dv">2052499839</span>,</span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>      <span class="at">covariateValue =</span> model<span class="sc">$</span>fitted.values </span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>    )</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>  }</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>    gisData <span class="ot">&lt;-</span> trainData<span class="sc">$</span>labels</span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>    X <span class="ot">&lt;-</span> gisData<span class="sc">$</span>PMVALUE</span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>    y <span class="ot">&lt;-</span> gisData<span class="sc">$</span>outcomeCount</span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>    newData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y=</span>y, <span class="at">X=</span>X)</span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>    yHat <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, newData)</span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>    newData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>      <span class="at">rowId =</span> gisData<span class="sc">$</span>rowId,</span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a>      <span class="at">covariateId =</span> <span class="dv">2052499839</span>,</span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a>      <span class="at">covariateValue =</span> yHat</span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a>    )</span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a>  }</span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a>  <span class="co"># update covRef</span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a>  Andromeda<span class="sc">::</span><span class="fu">appendToTable</span>(trainData<span class="sc">$</span>covariateData<span class="sc">$</span>covariateRef, </span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a>                           <span class="fu">data.frame</span>(<span class="at">covariateId=</span><span class="dv">2052499839</span>,</span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a>                                      <span class="at">covariateName=</span><span class="st">&#39;Average PM2.5 Concentrations&#39;</span>,</span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a>                                      <span class="at">analysisId=</span><span class="dv">1</span>,</span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a>                                      <span class="at">conceptId=</span><span class="dv">2052499839</span>))</span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a>  </span>
<span id="cb4-54"><a href="#cb4-54" tabindex="-1"></a>  <span class="co"># update covariates</span></span>
<span id="cb4-55"><a href="#cb4-55" tabindex="-1"></a>  Andromeda<span class="sc">::</span><span class="fu">appendToTable</span>(trainData<span class="sc">$</span>covariateData<span class="sc">$</span>covariates, newData)</span>
<span id="cb4-56"><a href="#cb4-56" tabindex="-1"></a>  </span>
<span id="cb4-57"><a href="#cb4-57" tabindex="-1"></a>  featureEngineering <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-58"><a href="#cb4-58" tabindex="-1"></a>    <span class="at">funct =</span> <span class="st">&#39;implementPollutants&#39;</span>,</span>
<span id="cb4-59"><a href="#cb4-59" tabindex="-1"></a>    <span class="at">settings =</span> <span class="fu">list</span>(</span>
<span id="cb4-60"><a href="#cb4-60" tabindex="-1"></a>      <span class="at">featureEngineeringSettings =</span> featureEngineeringSettings,</span>
<span id="cb4-61"><a href="#cb4-61" tabindex="-1"></a>      <span class="at">model =</span> model</span>
<span id="cb4-62"><a href="#cb4-62" tabindex="-1"></a>    )</span>
<span id="cb4-63"><a href="#cb4-63" tabindex="-1"></a>  )</span>
<span id="cb4-64"><a href="#cb4-64" tabindex="-1"></a>  </span>
<span id="cb4-65"><a href="#cb4-65" tabindex="-1"></a>  <span class="fu">attr</span>(trainData<span class="sc">$</span>covariateData, <span class="st">&#39;metaData&#39;</span>)<span class="sc">$</span>featureEngineering <span class="ot">=</span> <span class="fu">listAppend</span>(</span>
<span id="cb4-66"><a href="#cb4-66" tabindex="-1"></a>    <span class="fu">attr</span>(trainData<span class="sc">$</span>covariateData, <span class="st">&#39;metaData&#39;</span>)<span class="sc">$</span>featureEngineering,</span>
<span id="cb4-67"><a href="#cb4-67" tabindex="-1"></a>    featureEngineering</span>
<span id="cb4-68"><a href="#cb4-68" tabindex="-1"></a>  )</span>
<span id="cb4-69"><a href="#cb4-69" tabindex="-1"></a>  </span>
<span id="cb4-70"><a href="#cb4-70" tabindex="-1"></a>  trainData<span class="sc">$</span>model <span class="ot">&lt;-</span> model</span>
<span id="cb4-71"><a href="#cb4-71" tabindex="-1"></a>  </span>
<span id="cb4-72"><a href="#cb4-72" tabindex="-1"></a>  <span class="fu">return</span>(trainData)</span>
<span id="cb4-73"><a href="#cb4-73" tabindex="-1"></a>}</span></code></pre></div>
<p>We can then execute these functions to create training and test data
objects that contain our extended covariates:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>featureEngineeringSettingsPol <span class="ot">&lt;-</span> <span class="fu">createPollutants</span>(<span class="st">&#39;QNCV&#39;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>trainDataPol <span class="ot">&lt;-</span> <span class="fu">implementPollutants</span>(trainData, featureEngineeringSettings)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>testDataPol <span class="ot">&lt;-</span> <span class="fu">implementPollutants</span>(testData, featureEngineeringSettings, trainDataPol<span class="sc">$</span>model)</span></code></pre></div>
<p>Note that if we plot the output model of the <code>GAM</code> fitting
in the <code>implementPollutants</code> function, we end up with a plot
that aligns well with our underlying relationship between Odds Ratio and
PM2.5 concentration that we used to distribute our synthetic data by
location:</p>
<div class="float">
<img src="data:application/octet-stream;base64,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" alt="Covariate Fit" />
<div class="figcaption">Covariate Fit</div>
</div>
<div class="float">
<img src="data:application/octet-stream;base64,AAAAHGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZgAAAZhtZXRhAAAAAAAAACFoZGxyAAAAAAAAAABwaWN0AAAAAAAAAAAAAAAAAAAAAA5waXRtAAAAAAABAAAANGlsb2MAAAAAREAAAgACAAAAAAG8AAEAAAAAAAAQKAABAAAAABHkAAEAAAAAAAAJ2AAAADhpaW5mAAAAAAACAAAAFWluZmUCAAAAAAEAAGF2MDEAAAAAFWluZmUCAAAAAAIAAGF2MDEAAAAA12lwcnAAAACxaXBjbwAAABNjb2xybmNseAABAA0ABoAAAAAMYXYxQ4EBHAAAAAAUaXNwZQAAAAAAAAJUAAABRgAAAA5waXhpAAAAAAEIAAAAOGF1eEMAAAAAdXJuOm1wZWc6bXBlZ0I6Y2ljcDpzeXN0ZW1zOmF1eGlsaWFyeTphbHBoYQAAAAAMYXYxQ4EBDAAAAAAUaXNwZQAAAAAAAAJUAAABRgAAABBwaXhpAAAAAAMICAgAAAAeaXBtYQAAAAAAAAACAAEEAYYHCAACBIIDBIUAAAAaaXJlZgAAAAAAAAAOYXV4bAACAAEAAQAAGghtZGF0EgAKBxhmJTorCoAymiBMgAi08W/LpZ0IbHUDwOfsfGYLsuT2QopsfHGnCol9KFxSMwbQlLm3S2job8uA6LoqNXxP/qBp4eNNnKi0QRyqSpMemi0i2HT98TWC2cYCW28fi/w1t1x1+2i10/UZVktEuYubvte5GixsgZbtFnLHBh66+DT8BLMHFO0R1ocydoAslZAz3nsGtvl0Ymejso54vihhwIS6fnmGLwz8DXGJGiqVe/1iPqgn7AXm/3zg8DRsceJjJYFDaA3KmCjTPyNBN6aiC0c5sGMnNaiqVRoXHQlljdHqWhsU23PaLWQ3Gq3jx3VXb3+RA7ediELZJB6iUaBcgqOmTeJdjR6RnogmDvesbvIwUvx/6xU9yJp3ytvj5wXDfDugJ6Zpi3wpby5Albf2kf75Fv3cFuIDPAAvh2l3kETIAfRkY5u65AUgOilyg6ohi1oVG7KAJivOhHm0yOM3X8pCu4leP5j74VVpBGV/m1QQdbIUDq1L0kQDf8qG702tJATzq1sJWjBXlFtLtw7CEyA2rx3IE+1HIxV9aHmysPmxptO7rO0NfMWOWKNUIBaI+iMBgbVQIta5BzPeHc19np8VF6QC96kvihIFwGMulkPEhaQdPWrp9xXM2/GahJE8zU8A+PuhZFv79uRP66qp0rJ32/IvJGQOiw0UrgCVRFG6D7PVqp3K+FNouGeeDPJExce8baMBbANxCTLBSzkW0G5LXefqnXOLwQrdxIzD9QXDdDhfrlH6qC2ISk0a+43qxtZquBHy7LgNyGt4X+qVv/Fqr1qyzFRK7zAyTBlbZjsXOBkaOmVOP+mi3lSq8HlHPDWeMXbkJ9lEEx3iG+q5TDR5vaNKIUTGY0KaLrrnI2X9Yr3D6VjxlCzkKGhYZsxyy8f9QDz2Jpww+QmBe/M5PBVxDY/8YoaHAGk3nzzGQo+NIKWsAlVGCBZoeXOk9O0nDuiX86NnZ89NvW9GsPpi0/YWrOkqapupyCHRgMmFshlFKojuIg7qKBE/QmShUt5niZoYf2lDTtX0ERDhlveJ8AtcNhUug3tAjIX+X+l0UcSTcGl2S8nYf5ZgEDPk32FXrvzo4j573qbTrKdlWP2TNLgGTXAA1/WwuPfIhkGC974/8ssVW37hE+XZkXrrBNUR3Xx4h1ZyVpV0lHuBf/DBTIyXz06sV/98d2NkNPJKPxig1peyb5sENWMzgJ1OLC4dkw3gTnXc3vpfKxR/bIbYsU/6INTkNnjXcTK3gIP3nQnOwM1izwibUAmZGRrikPmh/APxWPL3os8d9zeQEzohXaQYpOR7IlW3N8OXMKu8/TINg+kNLUiYs1hWVqXV2sMKxqXtYLQqH+JBxjjcjd1DXAR9eIXCvyLYBFskwybThQlyr0dcCPSNIjLb4hOtUJH6Rhg0FhtBahh0CDWBgo3YvowGgOObevutnPAmY6ODDb7zoKEgWN8fk/TvpUdYl5kyapYeVSiiRCKcXiDwVUQJkPisza7FQFeHZeJgCYdxi/RRy8BFmEpT1UOd7R+mQfUs3VnmS9M+m9x4Tcl34gTDwvCIBHv03goJwtMlhdepGcI/BVjpy0G8YJmPhV1Xk+gK8SLjimQr+OykuXXsFxJTMgiz0p2eLKYpWQLJ+mrHvvBvXeZFvNmNFkqgIbdOLzoYZ03e7Qd9wcCK7dPQJv/9XTnVcUPf07xP5SYJqtYT2x9YGv0m9MHAVR+9QYSI8EfPh9zTqAsEekyKGyt1cl5HxdDoArnSAbqw296tfwfLiYoXemSyIpZRMG0rPxkQZJtpNhOolPYAnSWVIoQh53BroAT4/zPTeWMUrgy9u9tuuM6q9B8v9eQExMye8g38RYgNPuH+WM+GtkXIf6BBjnsiJawpGBBMsLGY8r/qSTcjxByrIO9S6MkCXNYmwWFTfGEZNUOtUIejUWK+BQXafnooGNvBFzET7RGbLw+TDJxKuJnyz/So0LBN+MTjZut2OoowtohTB90yVegkywdo5jLPNIr0LbvtYkf5HA9CnUr4zzmpEo5Jkfs7R861Jg7AnRaklzZ+NMHoiN7qLEvDZmueHJZuWn4GwfehP6n9HehtQyZ+hCs1EcOaqkpHgVQu35nRjkbKu2PBnW10ka9hu56e4GsiZx8aFf32H9z77u0mEkXTHwy8RtOkN1GjcZ/BBu15gd4+r9rF9UYfJLhM9sb343KH+I7EhGWSkp2YNZjSCxSoKAL7bHHrVTtpHVCc4Ua5Or1+tuH4RiekiExzfUhm0tSLBlP8PvaA3XoiB4KzjyYOy546cJgxXp/BN+1I0XbIhJa5yrb1Er/jpTYjs3QEGklMosAOwC41LfV2mT3B2MjmovMnJzDI/EfJilPute+qfp9emz8bWy2KzOOAblvGE9QtFPGJ5FBXiFDFlq1bkADIlXVo6P8Ss5kCWyKrSfWkEmw+sRrfQTSJtLqZbXiy8RKKzergP40wlNdimhK9FhQbih/jUNj7R9PLljjAvE/T3OVElTco3+ThZ+8idgE/YH8Lhq7m/sa3Sz4dGguMyRtccF4gJ7n31DCCHbPYb3xAYi/AlVO9JAvKIHznbsF6v3yMR5t8kwUuqBJPSbN/0nWjqIuHpNonxNnzSKVn1M77TwwN2Ny6XyEOeZvIRTnmZraUBshm3vsVcrSgv4IEYSrWWh4pfIiPxeb6d4i6Gwdh3ACm+HmttEvc0YPPNEg7Q6dI+pYvusa31g5SlWqyAAaHDK45vWANwu0QV4tRD+Y6oM4LPRgDmxwRaLsKzSnf+Eac2UamGwscrWKk1vQSvcX+rwwMGofeRPGpm3hIrKO/zxDre5xxJchBAxRA4SRX1iRwXiGkr5kBEc8Y2N9wP53M+cHUHoo9FT46hZBHyiyZPM90cQmXii1cIrGceyhJfI/0Mf/ZfycUvwGxUhWUi/lHDSa0p6aEARSYjt8nf1egxHSM5mR4Mii2E+zyIjEHGbdMOBq6WiTA7eSXinr2wY1SwskiewkjSuQZDvClDp+oJHcN8bjX5LPRDEYTzjdcprBR12rZn9oy2ytLe0gNqZKMQaBu5D/77IHIMZE0gRdPuMJ50By22CsYPHCejTVciY8nJq1axmIcnPGjnuUA6brIJBJED5ucm2FICYJpfqQ6eXtj9HQc4xzi3AZAlQrVtNokjF0J2h7qHF9NVqLKbVWv+sEyGjCVUY8TKM5D8ZxU7d4dGms79T3kmCnF8+GzndnaYCfuIaZdW+1vIWUOhPWYAkYG/QwODp+gKZ8EfKi0qduW/xQu/tscKM2jKQhU4ItbyVP/j52I28svz03+dfbsu7ubm1VNxSxx9HUkumMTdFxd8UsBQz7HHA4t69lG8yYapRFQOJTmojT+OBWe7TZuO90roLex6VYBAXLA13npgr5KEWGXHSdNW9KwG9OBvY7llfoLGgii3NbUHcQgcCdEWr6CND7PDtXNFlaxK61mLN4GFh+TV6DdRdfnph7u+rKFPe+jCnB++/qNrvdyoBAzus5ZJTBIAOvoYLLjFk7oOi8Jb5ATgvPMRHHJl4eA69fPQ6fYcphO736ngof52L8PckXwUApevLaAHHdoObwQtrwhXAB/Wg/rjqRmJmAZweORx9LbxBqZBfox1lwLpQMSve+jmM97oqon/PPPXHQ+ZH85ICXF8hZ80R7/vufNDO80VWxx8k3Ds3H5oh3whytTrydLTfzsxjKBc5Xf2O3sDP0Cr3BeTH8kCQCHAcLkgPvCHVl39l0wRwM5qMTiE4fjdMxjJTyQjmcoGwdckAwRwhEUhAu4KLn5Hul+J0+WkhvV7PB1P4/9PGb5STKlNtC36w2YoiHJnTUwTiAu4Vpiq1ov2AoDyJq9Y6qm2t985WjhxEKBWt2iBEPWYDxYW3gq3rcpT94q3TE/Z5BO79LTXsCzgHuOzj7Q4o4J7JG7NtVuN4fOSlr5hXgnRFpMTSIGD9yLVQIwzQayHidNyHedhC1vJVF+Ga1RvwjvDq02xp66lrrxFFMpOaJ21yFbLYSiiV1DxKr5POWKfjrw9ho0eAIoBAGLJQq4pKOQHIXuJBKrk3Qo7/nhTUhI5S64bOOZYPCpcSNf7CJaMirzVQltJc1oJ/C1Vj0VOFxcHg7XFp8EZcJf+7pf5nCfhMvWmAvshqNfDIDkXR4TJxVuxTp9J9eOsddqlLPHHOSydAiTpmU/i+bbhujJYvzV7w3HMVuiUuLi9fXkhcy/B5BcNlzLJEuELxRwUulFoIcLWWW+WFWV4vDN7RkiyhgGgTBVjmqi4FtJGtbRpn/2usQ+SRjEhGiCZimFd+0OzY6fkyTF4FJCgLe334WBod2NrnhifSmcJM9osWfwEBjFPifUBA9Aa/p9z+tOJk6rcTE32CQcq3l/AzotSX3YCBw2nV3MgUoOvVUL937cp5PwYZ6Kl2sG6AJ51sQ/Xgn6yPnM7SPNWN6h1bFpo1awZtN8424zeKkxqwF7BP5xWqQBL7eoR84WBPlWjZWNbvqi/JUmnpJGKbj9pk8Q4ro39VAGQh52gZ6ZbxRAJpw7sg2giVv0ra5dk/u+A975WjehJYQqORBRC4MC2sXYF01uvlk80xs29m5Cjjz4VK4iFH4z9Xn9iTes0mmxQ9Z/zNHBuaphnISiOyrY9HSOuzR9N2MNbs0QEXeBM8JVLFwU2vzla0XCCwd8jFG2jLFED4kqxWU9iiB/Fe0OWINHIxEboLF67sTjzaSS08wb1IZX4mYF2JLYFxlFUgiWwQaUMUz0s8j/Q3pdgIcwscEBdEm4hWSS3gifzvIoId3jktmuSQTLzLKPLRVvnDSX+7JhcsKgzir07+ysA4669svVbnACh/NuWbt6Vv/CrWEQjKoJGpKB89hkBHBk06u7OFaSpXdEXTb8mZPVyMxd93vjOhWJ1jUJxE2ZwqkiTD1yyULddp8BS5YRnQP+hRo0TchfvDstnmy3Cz8IUB8zTJ4nU0HjsweNyzojaauwRNBzHnnUoJ3ctv3VqL/VWaOzpRHw6M2I1m5dryIbvZRORUvghF6GyqGR0aUKs2w9W8ZnlsNIKhIAV8Ogv//Lj8sXahPZGg4JuFXICFzJoqKw0jbFri20eTOPRB3DdmDgY+CrYQ92S2tt3h04WgI3AACEUaqs105fjx1ginmzzYrT+sjCOrvs+az3hVkfhcEj6fSvusnRttS4tSzXpSj74puB+XHp0YrmR26fVboRiyd+KI+EiTZ+UxQJYw6vnl/lVk6tD3nWojpjNRtmRX/XZze/JWB3LvrtKsLiLAzm0Wl6HZuJvGw41yz1EW0fA/RRNhiTpECNhqks9WpqibcTQlPiSVlTnkg4hH6iwOBnuHmLG+CEZEuyren0Om37TFfS4em1C3bZsszRLr/ofHBBeSU1NBHBupuk0eovcylUKN2Kwp1OOrws5BGU6Zf6xZYFwg+89pJeDI/ou66w8B24GR2PzZRANQrvp8ISDokkYA9X8/CiDSos3QNlNJqiDWe10cIzi6nTcjjRgNtDjvlddFqgG1ASAAoKGGYlOisEBDQaEDLHE0yAArR9LZsadZOTHzudj1c0JpP4JJPxmmjlQFplm17NTvuCSJGsbC2nPB5mmOYjXRGen5iYkXVuUgWCJ6dpVDPASAve3n9ba+Aq2BSneA44keZMpVvl3ekPOHT2xa/gpTYeijZ1j4v1iGpCsC2THwyMnXAO8RAyxpEQrCQJ2yGSqgWCY/4NG/q3AibGTJ5Rxy/p5U1t9H2GD0OVMN08it+igBOaXqKhj4IWNibliGs/3glR2Es0cRvjqMZdwAUYNPRPKIS2bgCHoKKGKePKZYK/jTBDlnjhCYVKnJZBe+VUyz9QKsfinRjE+bDAYMEK93fvoKP1PeAl2lpGqbdWnRot9BKlLkvblUgaVtDqi0QhhvgAV28T+vhvYPLmcz9cDAu4MC+nXJd0gv4lEYEVKBgDxH0H/XBWOuIYSPA6BVUQf1rNALKe9+nwcUkiTgyJRnS3SMETNiKxlwVLFdDgi+2IPRAe7hqIDxE3eqeWATok49MLxnXRE8xIpSjV5qrRnqQTnYHDhTvuO+T/EjLpe0lnMVJsWUo1iIFs+vr3/9orbbOVhr6PgqEKR0Vj48uIXlsn8qjzz/DNXkk3KVMn3/hNGk9Kv6PEdb14BAH10wKA1tM6DqF50Els8hWJzmeoXZv3E8hT0zcqRWevLS0O0IaCIJg3htPjYOJgdZW2ofrezehMTLDDitVkoVPlWDd1oP+M4P0yGTq66INSQX2gLgesDazbTNo5VR1/pXU1zGb3OmRmChMKMqFZTKKx6MJEI/GaqLIzvsdQ2L+6I2XuJ+VxGpG3BWzj5AK7eTeL3o+pXH63kb4egEJvxS9HYejxQWegXGUBDEPpn5yu/pgbM1Wzr0PHCCG1H3RjmD0WjqLPK8VZxPOAjOLxV/eVKEXmyOtrOsZLJ4WPri2XLmfMqdWEYbZYTORBgI5bLS7MbizQWmihOveeV6jZU5zABtJ97Wc79HgRGb9zc0x2wP5JmHoTU09KP6Dlt75sAcGPlSHZXhrLQYPua0W4rKcAu/YNTW2cz9bUc298AfvHvCi/kGist9OHpeqwJJKAGVlk+ociVkdn3dpIDP/EFLxg2msgi2VZTB2yr6ImG2F3tU9P69a6U60q9uj//xk0A9q8IVfhIxDuil2vHo/7oyOLqdhzRpFZ153LTPmQHpGdqaxNZYQQwPCNcksvJEwA6p3di0AWEFcssNGVbYttZiNzZ34ubYIiBsPabUOuGGjMmWgSi1M0gZokpFKcjrwgqksLq9SC8cvTz4ezZUEWHu7p17m0CW/zXe8DZfHUU77z+4IrBaPhPGBdeltjKGSixYG+EU9MbjDf5xS28Ga11AZfF4/q3KH5JfayQKrQRBi5uG7EoVo5mJDGidehn+WOwH9Y3LIPac3IUBG21842evKK89O677KdI51SV0I4e29rh+Qw5YXXSNTkNRtPpIKuOZrl1zNUmogAkdVo3tPbEGa1dN65PWT3zkcgbOEZdEtYLikCF2sBUH7xmS6z+FZytiNzk+CeJrc3Y3tyrV8ZBbvWbPDHgnTBgEJNwhvM8OwCfF+gm9drcEAEIIHINEMr4+sr2cHPyGYQU8jIU064wJPl7J0NULpFfYbkjVZS01YtdqYdsGl9VkCRPkrNl22Tw+nJUVJ2x/f8e8tYeruxFjVCHwJONIlssacX5CisW2WdpfEocDR3rwJFWaX4svyVqtIq9z+OJ7royUHYGpWp9MO/87vVTp3i0wwfGTqAcB+BoR/Cuvzailyx/F0MC2YzhOjTDSorYDgVxz+s3DnOZ7Q2KFmwwZFr3XfsJHpSVHB92tkW1VjDdf2fwx0/gUqqgpZFuh5VD0q4/vp1fQGKI75J0WyFEJNugspWPnBrwenH0sqcS25WQFGIbT9n0TPzQ6EziTKOQuZpRpLwLajjXmTmaKbhMcmcfI2mJmiMCkqOoBeu5l5rdfLXlzFUN3zIPVUBy1bEsxeoc9Hzh3SvZPx4nL2o7a6iRCoGEbp1ie8gbPAkQWNS0Cf9FlyaAtdxkEpKYjmn7fV3cbnX3ZK8mIXcaz6RThUVoWXiYyxfptQFHF+z0saBw977zvJaqYFkiNUWROIT3vSJ6rp69WFjIE5XA9NllqiyntWHIRwuOZEAupDWu8z2koDviDmQ9pZXC4nwPS/J/b4c7cjHN1DM5mYy20JvTkLmijRwETbslVXw9sR5pkjMGoeLAZardl/QNqXc6gUR2B5u0CRjGCyT0ImlaLBuOZlLGmSZ+zEYyF2zNYj4GJjPjKOFF5lcPdbgCqnO1LJxyNbS+gcSugMFFKeKvS2RPs6RBsvHBFf3BBX8mPluwf6Yfzj5QaaRibr19A3JKrupj6jf5tPrdLfTvj8tFWX+8Jklu/zjESxpRnOD2NczU+3nZDuCxREqEp1Dj7p6SrlbpiNpeItWcGuNKl2DMhQGq9CShynxQ/suk8KBg8Vu/bXaBye/rme0CdL7CILVOhWk0sV+A7E1PfEmLJ3DhpcoL7oJ8gk3F2yD8H3Si7lA+4GDKTBMRkczucoKJ/a5GnM5vMUtxoCC7j4Hh4EkYKv6dI9TylcV6YTZDPflsWevilJIfOnLKmndcG5YnkC50cUmrDUI+5d7AGFLkg9OaVeLOm7hw/ofouxkFiyLFULBOzqs6UK2p3GOz4+p2cgFxTtnPUt+v0e8NuhyseZysClwXJtdmYMUpa0P8gEhOQKH2D24dneBSi0CD73mZjeAGA8jess4okgy9oBitA/mlSeF7eTavM+yXEF4B0Ye98Js0e8iBD0OFn5Vd8VDNKXHTdr5mmpTJJgI7CcvxpeojAax863YdyqDOLFELuuUpvMYPr0o0IVuOLawl3Dsi4WaFvHHmarhXvEmnE327rYcMraRSeofgar3Z/gkp0v1OVIAuPpFYogZCg+FBCHqhcx3kjQnUkmxhlAKFUu5bRE6xdTeGPdZSAmTDty4V4qFtcuYqelMizDRJbwKkQ3RXCOPLXRHCu4L1DXyKkew3ZAUncHKl1YVDdGur3E6KFSknssAaBnQCuvvBkQ38gY6nSPjVzYvVY73g826wWtzW2t0PaAwQshh/8JYjrUpiycc4eUy2IGK0dYSIys+JhM8Cm2hsOR/7RnwrhlCRx1N4suBbdisxWbpi2MTTF3MBlc1FSDTmZRu17Ck08/ZD/8yVDgWd4LIzwglY5LG9RM2lMXpKpLN+HVFRE7YMztFO+iv2o01CfqoH47z93HNdjmyGeiFRuDtXsmMNvMliCuRgMU6OGtzwC1mI8TSyDRrP5ADRz5rFlZSl/ETriQI/o4IPHkYbihlfwvYkC4sEBhhMlL+o6q4/vFt40gVz/o=" alt="OR Estimation" />
<div class="figcaption">OR Estimation</div>
</div>
</div>
<div id="step-5-apply-new-train-and-test-datasets-to-runplp-and-evaluate-output" class="section level3">
<h3>Step 5: Apply new train and test datasets to <code>runPlp</code> and
evaluate output</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>analysisId <span class="ot">&lt;-</span> <span class="st">&#39;1&#39;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>analysisPath <span class="ot">=</span> <span class="fu">file.path</span>(saveDirectory, analysisId)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>settings <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="at">trainData =</span> trainDataPol, </span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="at">modelSettings =</span> <span class="fu">setLassoLogisticRegression</span>(),</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="at">analysisId =</span> analysisId,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="at">analysisPath =</span> analysisPath</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>)</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>ParallelLogger<span class="sc">::</span><span class="fu">logInfo</span>(<span class="fu">sprintf</span>(<span class="st">&#39;Training %s model&#39;</span>,settings<span class="sc">$</span>modelSettings<span class="sc">$</span>name))  </span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>  {</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    <span class="fu">do.call</span>(fitPlp, settings)</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>  },</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>  <span class="at">error =</span> <span class="cf">function</span>(e) { ParallelLogger<span class="sc">::</span><span class="fu">logError</span>(e); <span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>)</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> model<span class="sc">$</span>prediction</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co"># remove prediction from model</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>model<span class="sc">$</span>prediction <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#apply to test data if exists:</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="cf">if</span>(<span class="st">&#39;Test&#39;</span> <span class="sc">%in%</span> <span class="fu">names</span>(data)){</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>predictionTest <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>  {</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>    <span class="fu">predictPlp</span>(</span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>      <span class="at">plpModel =</span> model, </span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>      <span class="at">plpData =</span> testDataPol,</span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>      <span class="at">population =</span> testDataPol<span class="sc">$</span>labels</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>    )</span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>  },</span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>  <span class="at">error =</span> <span class="cf">function</span>(e) { ParallelLogger<span class="sc">::</span><span class="fu">logError</span>(e); <span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>)</span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a>predictionTest<span class="sc">$</span>evaluationType <span class="ot">&lt;-</span> <span class="st">&#39;Test&#39;</span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(predictionTest)){</span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a>  prediction <span class="ot">&lt;-</span> <span class="fu">rbind</span>(predictionTest, prediction[, <span class="fu">colnames</span>(prediction)<span class="sc">!=</span><span class="st">&#39;index&#39;</span>])</span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a>}</span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
